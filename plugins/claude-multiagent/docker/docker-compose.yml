services:
  claude:
    build:
      context: ../../..
      dockerfile: plugins/claude-multiagent/docker/Dockerfile
    image: claude-multiagent
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GH_TOKEN=${GH_TOKEN}
      - REPO=${REPO}
      - REPO_BRANCH=${REPO_BRANCH:-}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-}
      - CLAUDE_PROMPT=${CLAUDE_PROMPT:-}
      - GIT_USER_NAME=${GIT_USER_NAME:-Claude Agent}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-claude@agent.local}
      - MAX_BUDGET_USD=${MAX_BUDGET_USD:-}
    stdin_open: true
    tty: true
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '2'
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=512m
